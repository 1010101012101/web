{% comment %}
  Copyright (C) 2018 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n email_obfuscator humanize static add_url_schema %}
<!DOCTYPE html>
<html lang="en">

  <head>
    {% include 'shared/head.html' %}
    {% include 'shared/cards.html' %}
    <link rel="stylesheet" href={% static "v2/css/dashboard.css" %}>
    <link rel="stylesheet" href={% static "v2/css/profile.css" %}>
    <link rel="stylesheet" href={% static "v2/css/tag.css" %}>

    <style>
      .profile-bounties--loading {
        background-position: center;
        margin-bottom: 4rem;
      }

      #sidebar_container {
        background: #F2F6F9;
      }

      #sidebar_container h2 {
        font-weight: bold;
      }

      .sidebar-header {
        color: #007bff;
        font-weight: bold;
      }

      .bounty_row .avatar-container {
        text-align: center;
      }

      .org-list {
        display: inline-block;
        border: 1px solid #999;
        width: 3.2rem;
        height: 3.2rem;
        position: relative;
        text-align: center;
      }

      .org-list img {
        position: absolute;
        max-height: 2rem;
        max-width: 2rem;
        margin-left: -15px;
        margin-top: 9px;
        z-index: 2;
      }

      #sidebar_container .tag.org-hiring {
        margin: 0;
        bottom: 0;
        right: 0;
        position: absolute;
        min-width: 0;
      }

      #sidebar_container .tag.org-hiring p {
        padding: 2px 2px;
        font-size: 0.5rem;
      }

      .org-header__avatar {
        max-height: 7rem;
      }

      .org-user-info div {
        margin: 0;
        min-width: 0;
        width: auto;
        display: inline-block;
        padding: 0 14px;
      }

      .org-info .tag.org-hiring p {
        padding: 2px 2px;
      }

      #follow p {
        padding: 2px 8px;
      }

      .org-info .profile-header__links a {
        text-decoration: none;
        margin-right: 0.2rem;
      }

      .org-info .profile-header__links a i {
        color: #000;
      }

      .org-info .profile-header__links a:hover i {
        color: #1ab56d;
      }

      .org-members img {
        max-width: 40px;
        border-radius: 50%;
      }

      .works_with_list {
        list-style-type: none;
      }
    </style>
  </head>

  <body class="interior {{ active }}">
    {% include 'shared/tag_manager_2.html' %}
    <div class="container-fluid header dash">
      {% include 'shared/nav.html' %}
    </div>
    <div id="dashboard-content" class="row no-gutter">
      <div class="col-12 col-lg-3 col-xl-2 text-center" id="sidebar_container">
        <p class="sidebar-header my-4 font-body">Browse Organzations</p>
        <h2 class="font-subheader mb-4">{{ orgs|length }} Projects</h2>
        <div class="mx-4 text-left">
          {% for org in orgs %}
            <a href="{% url "account:explorer_organzations" org.github_username %}" class="org-list mx-1 my-2">
              <img src="{{ org.avatar_url }}">
              {% if org.is_hiring %}
                <div class="tag org-hiring">
                  <p>Hiring</p>
                </div>
              {% endif %}
            </a>
          {% endfor %}
        </div>
      </div>

      <div class="col-12 col-lg-9 col-xl-10 body">
        <div class="container-fluid" id="bounties">
          <div id="dashboard-title" class="hidden">
            {% include 'shared/search_bar.html' %}
            <div class="row mt-2 mb-2">
              <div class="col-12 offset-lg-1 col-lg-10 title-row">
                <div class="col-12 col-md-4">
                  <span id="filter" class="font-title"></span>
                  <span id="matches" class="font-body"></span>
                </div>
                <div class="col-12 col-md-8 bounty-info" id="funding-info">
                </div>
              </div>
            </div>
          </div>

          <div class="container my-4">
            <div class="row">
              <div class="col-12 col-md-2">
                <div class="text-center">
                  <img class="org-header__avatar"
                    src="{{ view_org.avatar_url }}">
                </div>
              </div>
              <div class="col-12 col-md-5 org-info">
                <h1 class="font-subheader mt-2">{{ view_org.github_username|title }}</h1>
                <div class="org-user-info font-caption boldify my-3">
                  {% if view_org.is_hiring %}
                    <div class="tag org-hiring mr-2">
                      <p>Hiring</p>
                    </div>
                  {% endif %}
                  <div id="follow" class="button--primary-o tag">
                    <p>{% if not follows_org %}Follow{% else %}Unfollow{% endif %}</p>
                  </div>
                </div>
                <p class="profile-header__links clearfix mt-1">
                  <a href="https://github.com/{{ view_org.github_username }}?tab=repositories" target="_blank" rel="noopener noreferrer" >
                    <i class="fab fa-github"></i>
                  </a>
                  {% if view_org.website_url %}
                    <a href="{{ view_org.website_url|add_url_schema }}" target="_blank" rel="noopener noreferrer" >
                      <i class="fas fa-home"></i>
                    </a>
                  {% endif %}
                  {% if view_org.email %}
                    <a href="mailto:{{ view_org.email|obfuscate }}">
                      <i class="far fa-envelope"></i>
                    </a>
                  {% endif %}
                </p>
              </div>
              <div class="col-12 col-md-5 org-members">
                <p class="font-body boldify mt-4">Members</p>
                  {% if org_members %}
                    <li class="works_with_list">
                      {% for member_user in org_members %}
                      <ul class="pl-0">
                        <a href="{% url 'profile' member_user.username %}">
                          <img src='/dynamic/avatar/{{ member_user.username }}' title="<div class='tooltip-info tooltip-xs'>{{ member_user.username }}</div>">
                        </a>
                      </ul>
                    {% endfor %}
                    </li>
                  {% else %}
                    This organization has no members on Gitcoin.
                  {% endif %}
              </div>
            </div>
          </div>

          <div class="container">
            <div class="row container">
              <div class="col-12 py-4">
                <div class="pb-2 profile-section-title">
                  {% trans "Open Bounties" %}
                </div>
              </div>
              <div class="col-12">
                <div class="container profile-bounties featured-bounties profile-bounties--loading">
                </div>
              </div>
            </div>
            <div class="row container ">
              <div class="col-12 py-4">
                <div class="pb-2 profile-section-title">
                  {% trans "In Progress" %}
                </div>
              </div>
              <div class="col-12">
                <div class="container profile-bounties profile-bounties--in--progress profile-bounties--loading">
                </div>
              </div>
            </div>
          </div>
          {% include 'shared/result.html' %}
        </div>
      </div>
    </div>

    {% include 'shared/result.html' %}

    {% include 'shared/analytics.html' %}
    {% include 'shared/footer_scripts.html' %}
    {% include 'shared/footer.html' %}
    {% include 'shared/messages.html' %}

    <script src="/dynamic/js/tokens_dynamic.js"></script>
    <script src="{% static "v2/js/tokens.js" %}"></script>
    <script>
      document.keywords = {{ keywords|safe }};
    </script>
    <script>
      var open_issues_uri, in_progress_issues_uri;
      if(document.location.href.startsWith('https://gitcoin.co')) {
        open_issues_uri = 'network=mainnet&idx_status=open&org={{ profile }}';
        in_progress_issues_uri = 'network=mainnet&idx_status=started&org={{ profile }}';
      } else {
        open_issues_uri = 'idx_status=open&org={{ profile }}';
        in_progress_issues_uri = 'idx_status=started&org={{ profile }}';
      }
      fetchBountiesAndAddToList(open_issues_uri, '.featured-bounties');
      fetchBountiesAndAddToList(in_progress_issues_uri, '.profile-bounties--in--progress');
    </script>
  </body>
</html>
