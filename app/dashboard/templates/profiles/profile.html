{% load i18n email_obfuscator humanize static add_url_schema avatar_tags %}
<!DOCTYPE html>
<html lang="en">
  <head>
    {% include 'shared/head.html' %}
    {% include 'shared/cards_pic.html' %}
    <link rel="stylesheet" href={% static "v2/css/dashboard.css" %}>
    <link rel="stylesheet" href={% static "v2/css/profile.css" %}>
    <link rel="stylesheet" href={% static "v2/css/tag.css" %}>
    <link rel="stylesheet" href={% static "v2/css/tabs.css" %}>
  </head>
  <body class="interior {{ active }} g-font-muli">
    {% include 'shared/tag_manager_2.html' %}
    {% if not hidden %}
      {% if profile.is_org %}
        {% include 'profiles/organization.html' %}
      {% else %}
        {% include 'profiles/user.html' %}
      {% endif %}
    {% endif %}
    <div class="container">
    {% if hidden %}
      {% include 'profiles/hidden.html' %}
    {% else %}
      {% if activities %}
        <div class="row pt-4 py-2">
          <div class="container profile-bounties profile-bounties--activities">
            {% for group in activities %}
              <div class="row">
                <div class="col-12 px-4 px-lg-0">
                  <span class="font-caption profile-bounties__sort_label">{{ group.title }}</span>
                </div>

                {% if group.activity_bounties %}
                <div id="activity-tabs" class="tab-container mt-4 font-body">
                  <button type="button" id="all" class="section-tab">{% trans "All Activity" %} ({{ group.activity_bounties|length }})</button>
                  <button type="button" id="funded" class="section-tab">{% trans "Bounties Funded" %} ({{ funded_bounties_count }})</button>
                  <button type="button" id="completed" class="section-tab">{% trans "Bounties Completed" %}</button>
                  <button type="button" id="tips" class="section-tab">{% trans "Tips Received" %}</button>
                </div>
                <div id="activity-tabs-sections" class="tab-sections section">
                  <div id="section-all" class="tab-section active">
                    <div class="container">
                      <div class="row mb-3 p-2">
                        <div class="col-12">
                          {% for activity in group.activity_bounties %}
                            {% include "shared/profile_activities_bounty.html" %}
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="section-funded" class="tab-section">
                    <div class="container">
                      <div class="row mb-3 p-2">
                        <div class="col-12">
                          {% for activity in group.activity_bounties %}
                            {% if activity.activity_type == 'new_bounty' %}
                              {% include "shared/profile_activities_bounty.html" %}
                            {% endif %}
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="section-completed" class="tab-section">
                    <div class="container">
                      <div class="row mb-3 p-2">
                        <div class="col-12">
                          {% for activity in group.activity_bounties %}
                            {% if activity.activity_type == 'work_done' %}
                              {% include "shared/profile_activities_bounty.html" %}
                            {% endif %}
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </div>
                  <div id="section-tips" class="tab-section">
                    <div class="container">
                      <div class="row mb-3 p-2">
                        <div class="col-12">
                            {% for tip in tips %}
                            <div class="row result bounty_row {% if forloop.counter > 5 %}bounty_row--hidden{% endif %} {{ tip.network }}" {% if tip.github_url %}href="{{ tip.github_url }}"{% endif %}>
                              <div class="avatar-container col-1 justify-content-center special_tag hide_min_viewport">
                                <img src="{% url "avatar" %}?repo=https://github.com/{% if tip.from_username %}{{ tip.from_username }}{% else %}Self{%endif%}" class="avatar">
                              </div>
                              <div class="col-12 col-md-8 d-flex flex-column">
                                <div class="bounty-detail">
                                  {% if tip.comments_public %}
                                    <div class="title font-subheader">
                                      {% trans "Comments" %}: {{ tip.comments_public }}
                                    </div>
                                  {% endif %}
                                  <div class="bounty-summary col-12">
                                    <div class="info font-caption">
                                      from
                                      {% if tip.from_username %}
                                        {{ tip.from_username }}
                                      {% else %}
                                        {% trans "an anonymous user" %}
                                      {% endif %}
                                      &bull; {{ tip.received_on | naturaltime }}
                                    </div>
                                  </div>
                                </div>
                              </div>
                              <div class="col-12 col-md-3 tags font-caption align-items-center">
                                {% if tip.network != 'mainnet' %}
                                <div class="tag network_warning">
                                  <p>
                                    <span>{{ tip.network }}</span>
                                  </p>
                                </div>
                                {% endif %}
                                <div class="tag token">
                                  <p>
                                    {{ tip.amount }}
                                    <span>{{ tip.tokenName }}</span>
                                  </p>
                                </div>
                                {% if tip.value_in_usdt_now %}
                                  <div class="tag usd">
                                    <p>
                                      {{ tip.value_in_usdt_now }}
                                      <span>USD</span>
                                    </p>
                                  </div>
                                {% endif %}
                              </div>
                            </div>
                          {% endfor %}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                {% endif %}
              </div>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    {% endif %}
    </div>

    {% include 'shared/result.html' %}

    {% include 'shared/bottom_notification.html' %}
    {% include 'shared/analytics.html' %}
    {% include 'shared/footer_scripts.html'%}
    {% include 'shared/footer.html' %}
    {% include 'shared/messages.html' %}

    <!-- jQuery -->
    <script src="{% static "v2/js/abi.js" %}"></script>
    <script src="/dynamic/js/tokens_dynamic.js"></script>
    <script src="{% static "v2/js/tokens.js" %}"></script>
    <script src="{% static "v2/js/pages/profile_details.js" %}"></script>
    <script src="{% static "v2/js/shared.js" %}"></script>
    <script src="{% static "v2/js/pages/tabs.js" %}"></script>

    <script type="text/javascript">
      $(document).ready(function() {
        if ($('.profile-bounties--tips .bounty_row--hidden').length > 0) {
          var $button = $('.profile-bounties--tips .profile-bounties__btn-show-all');
          $button.removeClass('hidden');
          $button.on('click', function(event) {
            $(this).remove();
            $('.profile-bounties--tips .bounty_row').removeClass('bounty_row--hidden');
          });
        }
        setupTabs('#activity-tabs');

        {% if profile.is_org %}
          // Fetch bounties user is fulfiller
          fetchBountiesAndAddToList('network=mainnet&org={{ profile.org.github_username }}', '.profile-bounties--all');
          $('.profile-bounties--in-progress').parents('.container').remove();
          $('.profile-bounties--funded').parents('.container').remove();
          $('.profile-bounties--completed').parents('.container').remove();
          $('.profile-bounties--activities').parents('.container').remove();

        {% else %}
          $('.profile-bounties--all').parents('.container').remove();
          // Fetch user bounties: "in progress" / actively started.
          fetchBountiesAndAddToList('network=mainnet&started={{ profile.handle }}&status__in=started,submitted', '.profile-bounties--in-progress');
          // Fetch bounties user is owner
          fetchBountiesAndAddToList('network=mainnet&bounty_owner_github_username={{ profile.handle }}', '.profile-bounties--funded');
          // Fetch bounties user is fulfiller
          fetchBountiesAndAddToList('network=mainnet&fulfiller_github_username_done={{ profile.handle }}&idx_status=done', '.profile-bounties--completed');
        {% endif %}
      });
    </script>
  </body>
</html>
