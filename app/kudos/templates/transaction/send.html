{% extends 'transaction/base.html' %}
{% comment %}
  Copyright (C) 2018 Gitcoin Core

  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU Affero General Public License as published
  by the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU Affero General Public License for more details.

  You should have received a copy of the GNU Affero General Public License
  along with this program. If not, see <http://www.gnu.org/licenses/>.
{% endcomment %}
{% load i18n static %}
{% load kudos_extras %}
{% block 'scripts' %}
  <script src="{% static "v2/js/ipfs-api.js" %}"></script>
  <script src="{% static "v2/js/ipfs.js" %}"></script>
  <script src="{% static "v2/js/tokens.js" %}"></script>
  <script src="{% static "v2/js/abi.js" %}"></script>
  <script src="{% static "v2/js/amounts.js" %}"></script>
  <script src="{% static "v2/js/secrets.min.js" %}"></script>
  <script src="{% static "v2/js/ethereumjs-accounts.js" %}"></script>
  <script src="{% static "v2/js/tokens_dynamic.js" %}"></script>
  <script src="{% static "v2/js/pages/kudos_send.js" %}"></script>
  <script src="{% static "onepager/js/confetti.js" %}"></script>
  <script>
    (function (){
      this.kudosprice = function () {
        var elems = document.querySelectorAll('[data-kudosprice]')
        elems.forEach( function(elem){          
          new Promise(function(resolve, reject) {
            getUSDEstimate(elem.dataset.kudosprice, 'ETH', function(usdAmount){
              resolve( usdAmount)
            })
          }).then(function(result){
            addValue(elem, result) 
          }, function(reject){
            console.log(reject)
          })
        })
        
        function addValue(elem, result) {
          elem.children[0].textContent = `(${result.value} USD)`
        }
      }
    }())
    
    new kudosprice()  
  </script>
{% endblock %}
<!-- Main -->
{% block 'main' %}
<div>
  <canvas id="world" style="position:absolute; top:0px; left: 0px;"></canvas>
</div>
<section id="main" class="box-transaction">
  <header class="text-center">
    <!-- <span class="avatar line-back">
      <a href="{% url "tip" %}">
      </a>
    </span> -->
    <img src="{% static "v2/images/helmet.png" %}" class="bg-white mh-100 mw-100 mx-auto p-2" width="70"/>
    <h1 class="h2">{% trans "Send Kudos" %}</h1>

    <div class="my-4">
      <a href="/kudos/{{ kudos.id }}"><img src="{% static kudos.image %}" alt="{{ kudos.name }}" width="160" alt="" class="mb-2"></a>
      <span class="d-block">{{ kudos.name|humanize_name }}</span>
      <span class="d-block" data-kudosprice=>{{ kudos.price_in_eth }} ETH<small></small></span>
    </div>
    
  </header>
 

  <form id="send_eth">
    <!-- <div class="form-row">
      <div class="form-group col-md-6">
        <label for="" class="">{% trans "Amount of" %}</label>
        <select id="token" style="width:100px;" class="form-control" >
          <option value="0x0">ETH</option>
        </select>
      </div>
      <div class="form-group col-md-6">
        <input name="amount" type="text" placeholder="1.1" id="amount" class="form-control">
        <div id="usd_amount" class="form-text"> &nbsp;</div>
      </div>
    </div> -->
    <input type="hidden" id="token" value="0x408c49a91e46311ddc35737f8c1aaea6191f36e0">
    <input type="hidden" id="amount" value="0.0011">
    <div class="form-group">
      <label for="">{% trans "To Github Username" %}:</label>
      <input type="text" placeholder="@username" id="username" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="">{% trans "To Wallet Address" %}:</label>
      <input type="text" placeholder="0x0" id="receiverAddress" class="form-control" required>
    </div>
    <div class="form-group">
      <label for="">{% trans "From Github Username" %} {% if not request.user.is_authenticated %}(<a href="{% url 'social:begin' 'github' %}?next=/kudos/send">{% trans "Login" %}</a>) {%endif%}</label>
      <input type="text" placeholder="@username" id="fromName" value="{% if user.is_authenticated  %}{{ user }}{% endif %}" class="form-control" disabled="disabled">
    </div>

    <div id="advanced_toggle" class="form-group text-center">
      <a href="#">{% trans "Advanced" %} >></a>
    </div>
    <div id='advanced' style="display:none;">
      <div class="form-group">
        <label for="">{% trans "Related Github Issue URL" %} ({% trans "optional" %}):</label>
        <input type="text" placeholder="https://github.com/user/repo/pull|issues/n" id="issueURL" class="form-control">
      </div>
      <div class="form-group">
        <label for="">{% trans "To Email address" %} ({% trans "optional" %}):</label>
        <input type="email" placeholder="foo@bar.it" id="email" class="form-control">
      </div>
      <div class="form-group">
        <label for="">{% trans "From Email" %} ({% trans "optional" %}):</label>
        <input type="email" placeholder="you@domain.co" id="fromEmail" value="{% if from_email %}{{ from_email }}{% endif %}" class="form-control">
      </div>
      <div class="form-group">
        <label for="">{% trans "Expires" %}:</label>
        <select id="expires" class="form-control">
          <option value="86400">1 {% trans "day" %}</option>
          <option value="259200">3 {% trans "days" %}</option>
          <option value="604800" selected="selected">1 {% trans "week" %}</option>
          <option value="1209600">2 {% trans "weeks" %}</option>
          <option value="2592000">1 {% trans "month" %}</option>
          <option value="7776000">3 {% trans "months" %}</option>
          <option value="15552000">6 {% trans "months" %}</option>
          <option value="31536000" selected="">1 {% trans "year" %}</option>
          <option value="9999999999">{% trans "Never" %}</option>
        </select>
      </div>
      <div class="form-group">
        <label for="">{% trans "Private Comments" %} ({% trans "optional" %}):</label>
        <textarea id="comments_priv" class="form-control"></textarea>
      </div>
      <div class="form-group">
        <label for="">{% trans "Public Comments" %} ({% trans "optional" %}):</label>
        <textarea id="comments_public" class="form-control"></textarea>
      </div>
    </div>
    <div class="form-group form-check text-center">
      <input type="checkbox" id="tos" value="1" class="form-check-input" required>
      <label for="tos" class="form-check-label">{% trans "I understand &amp; agree to the" %} <a href="{% url "_terms" %}">{% trans "terms of service" %}</a>.</label>
    </div>
    <div class="text-center">
    <!-- <a href="#" id="send" class="btn btn-gc-purple">{% trans "Send" %} <span class="emoji">⚡️</span></a> -->
      <button class="btn btn-gc-purple" id="send">{% trans "Send" %} <span class="emoji">⚡️</span></button>
    </div>x
  </form>

  <div id="send_eth_done" style="display:none;" class="text-center">
    <h3>{% trans "Woo hoo!" %}</h3>
    <p>{% blocktrans %}Your <span id="tokenName">ETH</span> has been sent <a href="" target="_blank" rel="noopener noreferrer" id="trans_link">to the blockchain</a>.{% endblocktrans %}</p>
    <div id="loading_trans">
      <p class="font-smaller-1">
        <a href="" target="_blank" rel="noopener noreferrer" id="trans_link2" >{% trans "The transaction is still pending." %}</a><br>{% trans "This page will auto-update when the transaction is confirmed" %} <br>({% trans "but you can close the browser window if you want" %}).
      </p>
      
      <img src="{% static "onepager/images/loading_v2.gif" %}" width="70" style="margin-right: 9px;">
    </div>
    <hr>
    <h3 class="font-weight-300">{% blocktrans %}<span id="new_username">the user</span> has been notified{% endblocktrans %}</h3>
    <p>{% trans "with instructions about how to receive their kudos." %}</p>
    <br>
    <a id="" class="btn btn-gc-purple" href="{% url "kudos_send" %}">⬅ {% trans "Start Over" %}</a>
  </div>
</section>
{% endblock %}
